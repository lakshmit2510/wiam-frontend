<div>
  <nz-page-header [nzGhost]="false">
    <nz-page-header-title> Parts Request List</nz-page-header-title>
    <nz-page-header-extra>
      <a routerLink="create-workorder">
        <button nz-button class="button-styles" nzType="secon" nzSize="large">
          <i nz-icon nzType="file-add" nzTheme="outline"></i> New Request Form
        </button>
      </a>
      <!-- <a routerLink="">
        <button nz-button class="button-styles" nzType="secon" nzSize="large">
          <i nz-icon nzType="printer" nzTheme="outline"></i> Print
        </button>
      </a> -->
    </nz-page-header-extra>
  </nz-page-header>
  <nz-page-header-content>
    <dx-data-grid *ngIf="!loadingData" [dataSource]="workOrderList" [showColumnLines]="true" [showRowLines]="true"
      [showBorders]="true" [rowAlternationEnabled]="true" style="max-height: calc(100vh - 200px);"
      [masterDetail]="{ enabled: true, template: 'partsListTemplate' }" (onRowExpanding)="onRowExpanding($event)">
      <dxo-paging [pageSize]="10"></dxo-paging>
      <dxo-pager [showPageSizeSelector]="true" [allowedPageSizes]="[5, 10, 20]" [showInfo]="true"> </dxo-pager>
      <dxo-search-panel [visible]="true"></dxo-search-panel>
      <dxi-column *ngFor="let item of requestListColumns" [dataField]="item.key" [caption]="item.name"
        [width]="item.width"></dxi-column>
      <dxi-column caption="Status" cellTemplate="statusTemplate" [width]="100"></dxi-column>
      <dxi-column caption="Action" [allowFiltering]="false" [allowSorting]="false" cellTemplate="actionTemplate"
        [width]="250"></dxi-column>
      <div *dxTemplate="let d of 'actionTemplate'">
        <button *ngIf="userInfo.role === 'Admin'" nz-button nzType="primary" nzSize="small"
          (click)="showConfirm(d.data.RequestId)" [disabled]="d.data.Status === 'Not Delivered'">
          Delivery
        </button>
        <nz-divider *ngIf="userInfo.role === 'Admin'" nzType="vertical"></nz-divider>
        <button nz-button nzType="danger" nzSize="small" (click)="showDeleteConfirm(d.data.RequestId)"
          [disabled]="d.data.Status === 'Not Delivered'">
          Cancel
        </button>
        <!-- <nz-divider nzType="vertical"></nz-divider>
        <button nz-button nzType="primary" nzSize="small" (click)="printForm(d.data.RequestId)">
          Print
        </button> -->
      </div>
      <div *dxTemplate="let d of 'statusTemplate'">
        <span [ngClass]="getStatus(d.data.Status)">{{ d.data.Status }}</span>
      </div>
      <div *dxTemplate="let part of 'partsListTemplate'">
        <dx-data-grid [dataSource]="partsList" [showColumnLines]="true" [showRowLines]="true" [showBorders]="true"
          [columnAutoWidth]="true">
          <dxi-column dataField="PartsName" caption="Parts Name"></dxi-column>
          <dxi-column dataField="ItemNumber" caption="Item Number"></dxi-column>
          <dxi-column caption="QTY Requested" cellTemplate="qtyRequestedTemplate"></dxi-column>
          <div *dxTemplate="let d of 'qtyRequestedTemplate'">
            {{ partsRequested[d.data.PartsID] }}
          </div>
        </dx-data-grid>
      </div>
    </dx-data-grid>
  </nz-page-header-content>
</div>
